
//DVD Screensaver by Malte




//NICHT IN DEN CODE GUCKEN WEIL SPOILER EINFACH AUSFÜHREN WEIL ICH BNIN JA VERTRAUENSWÜRDIG

/*

 KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK00OOOOkkkkkkkOOO00KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK0Okxolc:;;,''.................',;:cldxO0KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK0kdl:;'..                                  ..';cdk0KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKOdc;'.                                               .'cdOKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKOdc,.                                                        .:d0KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKOo:.                                                               'lOKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK0d:.                      ........'''''''''.........                    .lOKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKOo,                    ....''''''''''''''''''''''''''''.....                'dKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKKKKKKKKKKKKKKKKKKOl.                 ....''''''''''''''''''''''''''''''''''''''....             .cOKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKKKKKKKKKKKKKKKK0o.                ...''''''''''''''''''''''''''''''''''''''''''''''...            ;OKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKKKKKKKKKKKKKKKx,               ...''''''''''''''''''''''''''''''''''''''''''''''''''''..           ,kKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKKKKKKKKKKKKK0l.             ...'''''''''''''''''''''''''''''''''''''''''''''''''''''''''.           ,OKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKKKKKKKKKKKKk,             ...''..............''''''''''''''''''''''''''''''''''''''''''''..          :0KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKKKKKKKKKKOd'        .....................................''''''''''''''''''''''''''''''''...         .lKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKKKKK0xoc;'....................................................''''''''''''''''''''''''''''...         .xKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKKK0xc,.............................................................''''''''''''''''''''''''...          ;OKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKKKOl,...................................................................'''''''''''''''''''''....         .oKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKKOl'............................'''''''''''''..............................''''''''''''''''''''...          ,OKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKKx,..............',;clodxkOO000K000Okkkkkkkkkkkkxxxddollc:;,'................'''''''''''''''''''....         .oKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKKd...........':lxOKXNWMMMMMMMMMMMMMWNK0OOOOOOOOOOOOOOOOOO00OOkxc,...............'''''''''''''''''....          ,OKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKKo..........'lOXNWMMMMMMMMMMMMMMMMMMMMWKOOOOOOOOOOOOOOOOOOOOOOOOkoc;'.............''''''''''''''''.....         .dKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKKx'.........;xKNMMMMMMMMMMMMMMMMMMMMMMMWKOOOOOOOOOOOOOOOOOOOOOOOOOklcc;.............'''''''''''''''.....          :0KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKO:.........,x0XMMMMMMMMMMMMMMMMMMMMMMWNKOOOOOOOOOOOOOOOOOOOOOOOOOOOoccc:;'..........'''''''''''''''......         'OXKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK
 KKKd..........oOOKWMMMMMMMMMMMWWNNXXXKKK0OOOOOOOOOOOOOOOOOOOOOOOOOOOOOdccccc;...........''''''''''''''......         .,:cclodxkOKKKKKKKKKKKKKKKKKKKKKK
 KK0:.........;k0OOKXNWWNNNXXKK00OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOkocccccc'..........''''''''''''''......                 ...';:lxO0KKKKKKKKKKKKKKK
 KKk,.........:OOOOOOO000OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOkoccccccc,..........''''''''''''''......                         .':lx0KKKKKKKKKKK
 KKx'.........:kOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOxlcccccccc;..........''''''''''''''.......                             .:x0KKKKKKKK
 KKd..........:dOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOkxocccccccccc;..........'''''''''''''''......                               .l0KKKKKKK
 KKd..........:ldOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOkxolcccccccccccc;..........'''''''''''''''......                                .oKKKKKKK
 KKx..........:ccoxkOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOkxdolccccccccccccccc,..........'''''''''''''''.......          .'''''''.....         ,OKKKKKK
 KKO,.........:ccccloodxxxkkOOOOOOOOOOOOOOOOOOOOOOkkxxddolccccccccccccccccccc:'..........'''''''''''''''.......         .'''''''''''''..       .oKKKKKK
 KKKc.........,ccccccccccccllooooddddddddddddoooollcccccccccccccccccccccccccc,..........''''''''''''''''.......          .''''''''''''''.       ,OKKKKK
 KKKk'.........,:cccccccccccccccccccccccccccccccccccccccccccccccccccccccccc;'...........''''''''''''''''.......          .'''''''''''''''.      .dKKKKK
 KKKKo...........;:ccccccccccccccccccccccccccccccccccccccccccccccccccccccc,.............''''''''''''''''........         .''.....''''''''.       :0KKKK
 KKKKKo............,;:cccccccccccccccccccccccccccccccccccccccccccccccccc;'.............'''''''''''''''''........         ...............'.       'OXKKK
 KKKKKKd'.............',;:ccccccccccccccccccccccccccccccccccccccccccc;,...............''''''''''''''''''........         .................       .dXKKK
 KKKKKKKOc.................',,;::cccccccccccccccccccccccccccccc::;,'.................'''''''''''''''''''........         .................        cKKKK
 KKKKKKKKKk:.......................'',,,;;;;::::::::;;;;;,,,''......................''''''''''''''''''''........         ..................       ;0KKK
 KKKKKKKKKK0; .....................................................................'''''''''''''''''''''........         ..................       'kKKK
 KKKKKKKKKKO,     ...............................................................'''''''''''''''''''''''........         ..................       .dXKK
 KKKKKKKKKKk'        .........................................................''''''''''''''''''''''''''........         ..................        lKKK
 KKKKKKKKKXx.        .''................................................'''''''''''''''''''''''''''''''.........         ..................        :0KK
 KKKKKKKKKXx.        .''''''''''..................................'''''''''''''''''''''''''''''''''''''.........         ..................        ,OKK
 KKKKKKKKKXd.        .'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''.........         ..................        .kKK
 KKKKKKKKKXo.        .'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''.........         ..................        .dXK
 KKKKKKKKKKl        .''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''.........         ..................        .oKK
 KKKKKKKKKKl        ..''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''..........         ..................         cKK
 KKKKKKKKKKl        ..''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''..........         ..................         :0K
 KKKKKKKKKKc        ..'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''...........         ..................         ;0K
 KKKKKKKKKKc        ...''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''...........         ..................         ,OK
 KKKKKKKKKKc        ....''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''............         ..................         ,OK
 KKKKKKKKKKc        ....''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''............         ..................         'OK
 KKKKKKKKKKl        .....''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''.............         ..................         ,OK
 KKKKKKKKKKl         .....''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''..............         ..................         ,OK
 KKKKKKKKKKo.        .....'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''...............         ..................         ;0K
 KKKKKKKKKXo.        ......'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''................         ..................         ;0K
 KKKKKKKKKXd.        .......'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''................          ..................         :KK
 KKKKKKKKKXx.        ........''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''..................          ..................         lKK
 KKKKKKKKKKk'         .........''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''....................          ..................        .oKK
 KKKKKKKKKKO,         ...........'''''''''''''''''''''''''''''''''''''''''''''''''''''''.......................          .................         .xXK
 KKKKKKKKKK0;         ..............'''''''''''''''''''''''''''''''''''''''''''''''''..........................          .................         'OKK
 KKKKKKKKKKKc         .................''''''''''''''''''''''''''''''''''''''''''..............................          .................         :0KK
 KKKKKKKKKKKo.         .....................''''''''''''''''''''''''''''''.....................................          .................        .oKKK
 KKKKKKKKKKXk.         ........................................................................................          ................         .kXKK
 KKKKKKKKKKK0;         ........................................................................................          ................         :0KKK
 KKKKKKKKKKKKc         ........................................................................................          ...............         .xKKKK
 KKKKKKKKKKKKd.        ........................................................................................          ..............          :0KKKK
 KKKKKKKKKKKKO,         .......................................................................................          .............          'kKKKKK
 KKKKKKKKKKKKK:         .......................................................................................          ............           lKKKKKK
 
 */

import ddf.minim.*;

Minim minim;
AudioPlayer[] sfx = new AudioPlayer[10];
int pl = 0;

float sps = 120; //Steps per Seconds
float multiplier = 1; //Speedboost

int balls = 0;
float[] x = new float[balls];
float[] y = new float[balls];
float[] px = new float[balls];
float[] py = new float[balls];
float[] mx = new float[balls];
float[] my = new float[balls];
int[] lastHitMs = new int[balls];
int[] xhitms = new int[balls];
int[] yhitms = new int[balls];

int hits = 0;
boolean hit = false;

boolean benchmarkrunning = true;
int totalBenchmarkTime = 0;
float benchmarkp = 0;

void setup() {

  fullScreen(P2D);
  background(0);
  thread("movement");
  frameRate(144);

  minim = new Minim(this);
  for (int i = 0; i < sfx.length; i++) {
    sfx[i] =  minim.loadFile("data/sfx9.mp3");
  }

  thread("benchmark");
}

void benchmark() {
  int startms = millis();
  for (int i = 0; i < 1000*100000*100000; i++) {
    benchmarkp = float(i) / float(1000*100000*100000);
  }
  int time = millis() - startms;
  println("Benchmark took " + time + "ms");
  totalBenchmarkTime += time;

  balls = (int)map(time, 5, 50, 200, 10);
  x = new float[balls];
  y = new float[balls];
  px = new float[balls];
  py = new float[balls];
  mx = new float[balls];
  my = new float[balls];
  lastHitMs = new int[balls];
  xhitms = new int[balls];
  yhitms = new int[balls];
  for (int i = 0; i < balls; i++) {
    x[i] = random(width);
    y[i] = random(height);
    mx[i] = random(-2, 2);
    my[i] = random(-2, 2);
    px[i] = x[i];
    py[i] = y[i];
  }
  PFont f = createFont("data/DS-DIGI.TTF", height/2);
  textFont(f);
  benchmarkrunning = false;
}

void draw() {
  if (!benchmarkrunning) {
    if (hit) {
      hit = false;
      background(255);
    }
    noStroke();
    fill(0, 20);
    rect(0, 0, width, height);

    for (int i = 0; i < balls; i++) {
      float r = max(2, map(lastHitMs[i], millis(), millis()-500, 25, 5));
      stroke(222, min(222, (millis()*.5 - lastHitMs[i])), min(222, (millis()*.5 - lastHitMs[i])));
      strokeWeight(r);
      line(x[i], y[i], px[i], py[i]);
      noStroke();
      fill(255, min(255, (millis()*.5 - lastHitMs[i])), min(255, (millis()*.5 - lastHitMs[i])));
      ellipse(x[i], y[i], r, r);
      px[i] = x[i];
      py[i] = y[i];
    }

    multiplier += (1 - multiplier) * 0.1;

    fill(255);
    noStroke();
    textSize(height/8 + 50 * multiplier);
    textAlign(CENTER, CENTER);
    text(hits, width/2, height/2);
  } else {
    background(0);
    textSize(10);
    text("Es wird ein Benchmark durchgeführt... " + (int)(benchmarkp * 100) + "%", 10, 10);
  }
}

void movement() {
  int ms = millis();
  while (true) {
    ms = millis();
    for (int i = 0; i < balls; i++) {
      x[i] += mx[i];
      y[i] += my[i];
      boolean xhit = false;
      if (x[i] < 0 || x[i] > width) {
        mx[i] = -mx[i];
        xhit = true;
        xhitms[i] = ms;
      }
      boolean yhit = false;
      if (y[i] < 0 || y[i] > height) {
        my[i] = -my[i];
        yhit = true;
        yhitms[i] = ms;
      }

      if (lastHitMs[i] < millis()-200 && xhitms[i] > millis()-100 && yhitms[i] > millis()-100) {
        hits++;
        multiplier = 40;
        lastHitMs[i] = ms;
        hit = true;
        sfx[pl].rewind();
        sfx[pl].play();
        pl++;
        if (pl >= sfx.length) pl = 0;
      }
    }
    while (millis() < ms + 1000 / (sps * multiplier)) delay(1);
  }
}
